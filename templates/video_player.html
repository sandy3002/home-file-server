{% extends "base.html" %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1><i class="bi bi-play-circle"></i> Video Player</h1>
      <div>
        <a
          href="{{ url_for('download_file', filepath=filepath) }}"
          class="btn btn-success"
        >
          <i class="bi bi-download"></i> Download
        </a>
        <a
          href="{{ url_for('browse_files', subpath=filepath.rsplit('/', 1)[0] if '/' in filepath else '') }}"
          class="btn btn-outline-secondary"
        >
          <i class="bi bi-folder"></i> Back to Folder
        </a>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-file-play"></i> {{ filename }}</h5>
      </div>
      <div class="card-body">
        <div class="ratio ratio-16x9">
          <video controls class="rounded" id="videoPlayer">
            <source
              src="{{ url_for('serve_media', filepath=filepath) }}"
              type="video/mp4"
            />
            Your browser does not support the video tag.
          </video>
        </div>

        <div class="mt-3">
          <div class="row">
            <div class="col-md-6">
              <h6><i class="bi bi-info-circle"></i> File Information</h6>
              <ul class="list-unstyled">
                <li><strong>Filename:</strong> {{ filename }}</li>
                <li><strong>Path:</strong> {{ filepath }}</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6><i class="bi bi-gear"></i> Player Controls</h6>
              <div class="btn-group" role="group">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="changePlaybackRate(0.5)"
                >
                  0.5x
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="changePlaybackRate(1)"
                >
                  1x
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="changePlaybackRate(1.25)"
                >
                  1.25x
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="changePlaybackRate(1.5)"
                >
                  1.5x
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="changePlaybackRate(2)"
                >
                  2x
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Video Controls and Info -->
    <div class="row mt-4">
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <h6><i class="bi bi-keyboard"></i> Keyboard Shortcuts</h6>
            <div class="row">
              <div class="col-6">
                <ul class="list-unstyled small">
                  <li><kbd>Space</kbd> - Play/Pause</li>
                  <li><kbd>←</kbd> - Rewind 10s</li>
                  <li><kbd>→</kbd> - Forward 10s</li>
                </ul>
              </div>
              <div class="col-6">
                <ul class="list-unstyled small">
                  <li><kbd>↑</kbd> - Volume Up</li>
                  <li><kbd>↓</kbd> - Volume Down</li>
                  <li><kbd>F</kbd> - Fullscreen</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h6><i class="bi bi-activity"></i> Playback Status</h6>
            <div id="playbackInfo">
              <p class="mb-1">
                <strong>Current Time:</strong>
                <span id="currentTime">00:00</span>
              </p>
              <p class="mb-1">
                <strong>Duration:</strong> <span id="duration">00:00</span>
              </p>
              <p class="mb-0">
                <strong>Speed:</strong> <span id="playbackRate">1x</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  const video = document.getElementById("videoPlayer");

  // Update playback info
  function updatePlaybackInfo() {
    const currentTime = document.getElementById("currentTime");
    const duration = document.getElementById("duration");
    const playbackRate = document.getElementById("playbackRate");

    if (video.currentTime && video.duration) {
      currentTime.textContent = formatTime(video.currentTime);
      duration.textContent = formatTime(video.duration);
    }
    playbackRate.textContent = video.playbackRate + "x";
  }

  function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);

    if (hours > 0) {
      return `${hours.toString().padStart(2, "0")}:${minutes
        .toString()
        .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
    }
    return `${minutes.toString().padStart(2, "0")}:${secs
      .toString()
      .padStart(2, "0")}`;
  }

  function changePlaybackRate(rate) {
    video.playbackRate = rate;
    updatePlaybackInfo();
  }

  // Event listeners
  video.addEventListener("loadedmetadata", updatePlaybackInfo);
  video.addEventListener("timeupdate", updatePlaybackInfo);
  video.addEventListener("ratechange", updatePlaybackInfo);

  // Keyboard controls
  document.addEventListener("keydown", function (e) {
    // Only handle shortcuts if video is focused or no input is focused
    if (
      document.activeElement.tagName === "INPUT" ||
      document.activeElement.tagName === "TEXTAREA"
    ) {
      return;
    }

    switch (e.code) {
      case "Space":
        e.preventDefault();
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
        break;
      case "ArrowLeft":
        e.preventDefault();
        video.currentTime = Math.max(0, video.currentTime - 10);
        break;
      case "ArrowRight":
        e.preventDefault();
        video.currentTime = Math.min(video.duration, video.currentTime + 10);
        break;
      case "ArrowUp":
        e.preventDefault();
        video.volume = Math.min(1, video.volume + 0.1);
        break;
      case "ArrowDown":
        e.preventDefault();
        video.volume = Math.max(0, video.volume - 0.1);
        break;
      case "KeyF":
        e.preventDefault();
        if (video.requestFullscreen) {
          video.requestFullscreen();
        }
        break;
    }
  });

  // Initialize
  updatePlaybackInfo();
</script>
{% endblock %}
